<!DOCTYPE html>
<html>
<head>
    <title>Create Post</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container mt-5" style="max-width: 600px;">
    <h3 class="text-center mb-4">Create Blog Post</h3>

    <div class="card p-4 shadow-sm">
        <input id="title" class="form-control mb-3" placeholder="Title">

        <input id="description" class="form-control mb-3" placeholder="Description">

        <textarea id="content" class="form-control mb-3" placeholder="Content" rows="5"></textarea>

        <button class="btn btn-success w-100" onclick="createPost()">Create</button>

        <p id="msg" class="mt-3 text-center"></p>

        <button id="newPostBtn"
                class="btn btn-secondary w-100 mt-3"
                style="display:none;"
                onclick="createNewPost()">
            Create Another Post
        </button>
    </div>
</div>


<script>
async function createPost() {
    const token = localStorage.getItem("token");

    if (!token) {
        document.getElementById("msg").innerText = "You must log in first!";
        return;
    }

    const data = {
        title: document.getElementById("title").value,
        description: document.getElementById("description").value,
        content: document.getElementById("content").value,
    };

    try {
        const res = await fetch("http://localhost:8080/api/v1/posts", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(data)
        });

        const result = await res.json();

        if (res.status === 200 || res.status === 201) {
            document.getElementById("msg").innerText = "Post created successfully!";
            document.getElementById("newPostBtn").style.display = "block";
        } else {
            document.getElementById("msg").innerText =
                "Error: " + (result.message || "Failed to create post");
        }
    } catch (error) {
        document.getElementById("msg").innerText = "Error connecting to server!";
    }
}


function createNewPost() {
    document.getElementById("title").value = "";
    document.getElementById("description").value = "";
    document.getElementById("content").value = "";
    document.getElementById("msg").innerText = "";
    document.getElementById("newPostBtn").style.display = "none";
}
</script>


</body>
</html>
